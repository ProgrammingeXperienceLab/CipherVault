<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CipherVault - PXL</title>
<style>
  body { background-color:#0a0a0a;color:#00ffcc;font-family:'Courier New',monospace;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;overflow:hidden;position:relative;}
  canvas#matrix {position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;}
  .container {position:relative;z-index:1;background:rgba(17,17,17,0.85);padding:2rem;border-radius:1rem;box-shadow:0 0 30px #00ffcc80;width:90%;max-width:500px;backdrop-filter:blur(5px);animation:glitch 2s infinite;}
  @keyframes glitch {0%,20%,40%,60%,80%,100%{transform:translate(0);}10%{transform:translate(-2px,2px);}30%{transform:translate(2px,-2px);}50%{transform:translate(-2px,-2px);}70%{transform:translate(2px,2px);}90%{transform:translate(-1px,1px);}}
  h1{margin:0 0 0.2rem 0;text-shadow:0 0 5px #00ffcc,0 0 10px #00ffcc,0 0 20px #00ffaa;}
  p{font-size:0.9rem;margin:0 0 1rem 0;text-shadow:0 0 2px #00ffcc;}
  textarea,input{width:100%;margin:0.5rem 0;padding:0.5rem;background:#222;border:1px solid #00ffcc;color:#00ffcc;border-radius:0.3rem;font-family:monospace;transition:0.3s;}
  textarea:focus,input:focus{outline:none;box-shadow:0 0 5px #00ffaa;border-color:#00ffaa;}
  button{background:#00ffcc;color:#111;padding:0.5rem 1rem;border:none;cursor:pointer;margin:0.3rem;border-radius:0.3rem;transition:0.2s;}
  button:hover{background:#00ffaa;}
  .buttons{display:flex;justify-content:space-between;}
  .footer{font-size:0.7rem;margin-top:0.5rem;text-align:center;color:#00ffcc80;}
  .footer a{color:#00ffcc;text-decoration:none;}
  .footer a:hover{text-decoration:underline;}
</style>
</head>
<body>
<canvas id="matrix"></canvas>

<div class="container">
  <h1>CipherVault</h1>
  <p>Secure encryption & decryption tool by <strong>PXL – Programming eXperience Lab</strong></p>

  <textarea id="inputMessage" placeholder="Enter your message..."></textarea>
  <input type="password" id="password" placeholder="Enter strong password">
  
  <div class="buttons">
    <button id="encryptBtn">Encrypt</button>
    <button id="decryptBtn">Decrypt</button>
  </div>
  
  <textarea id="outputMessage" placeholder="Your result..." readonly></textarea>

  <div class="footer">
    Made by <strong>PXL – Programming eXperience Lab</strong> | 
    <a href="https://github.com/ProgrammingeXperienceLab" target="_blank">GitHub</a>
    <br>Use HTTPS for best security
  </div>
</div>

<script>
// ===== Matrix Background =====
const canvas=document.getElementById('matrix'),ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;canvas.height=window.innerHeight;
const letters="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()*&^%";
const fontSize=16,columns=canvas.width/fontSize;
const drops=Array(Math.floor(columns)).fill(1);
function drawMatrix(){
  ctx.fillStyle="rgba(0,10,10,0.05)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#00ffcc";ctx.font=fontSize+"px monospace";
  for(let i=0;i<drops.length;i++){
    ctx.fillText(letters.charAt(Math.floor(Math.random()*letters.length)),i*fontSize,drops[i]*fontSize);
    if(drops[i]*fontSize>canvas.height&&Math.random()>0.975)drops[i]=0;
    drops[i]++;
  }
}
setInterval(drawMatrix,50);
window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;});

// ===== Security Helpers =====
async function getKey(password,salt){
  const enc=new TextEncoder();
  const keyMaterial=await crypto.subtle.importKey("raw",enc.encode(password),{name:"PBKDF2"},false,["deriveKey"]);
  return crypto.subtle.deriveKey({name:"PBKDF2",salt:salt,iterations:500000,hash:"SHA-256"},keyMaterial,{name:"AES-GCM",length:256},false,["encrypt","decrypt"]);
}
function getRandomBytes(length){const array=new Uint8Array(length);crypto.getRandomValues(array);return array;}
function bufToBase64(buf){return btoa(String.fromCharCode(...new Uint8Array(buf)));}
function base64ToBuf(base64){const binary=atob(base64);const bytes=new Uint8Array(binary.length);for(let i=0;i<binary.length;i++)bytes[i]=binary.charCodeAt(i);return bytes.buffer;}
function clearSensitive(...elements){elements.forEach(el=>el.value="");}

// ===== Password Strength Check =====
function checkPasswordStrength(password){
  if(password.length<12||!/[A-Z]/.test(password)||!/[a-z]/.test(password)||!/[0-9]/.test(password)||!/[!@#$%^&*]/.test(password)){
    alert("⚠️ Password should be at least 12 chars, include upper, lower, number, and special char.");
    return false;
  }
  return true;
}

// ===== Encrypt / Decrypt =====
async function encryptMessage(message,password){
  const salt=getRandomBytes(16),iv=getRandomBytes(12);
  const key=await getKey(password,salt);
  const enc=new TextEncoder();
  const encrypted=await crypto.subtle.encrypt({name:"AES-GCM",iv:iv},key,enc.encode(message));
  const combined=new Uint8Array(salt.byteLength+iv.byteLength+encrypted.byteLength);
  combined.set(salt,0);combined.set(iv,salt.byteLength);combined.set(new Uint8Array(encrypted),salt.byteLength+iv.byteLength);
  clearSensitive(document.getElementById('inputMessage'),document.getElementById('password'));
  return bufToBase64(combined);
}

async function decryptMessage(encryptedBase64,password){
  try{
    const combined=new Uint8Array(base64ToBuf(encryptedBase64));
    const salt=combined.slice(0,16),iv=combined.slice(16,28),data=combined.slice(28);
    const key=await getKey(password,salt);
    const decrypted=await crypto.subtle.decrypt({name:"AES-GCM",iv:iv},key,data);
    clearSensitive(document.getElementById('inputMessage'),document.getElementById('password'));
    return new TextDecoder().decode(decrypted);
  }catch{
    return "❌ Decryption failed. Check your password!";
  }
}

// ===== Event Listeners =====
document.getElementById('encryptBtn').addEventListener('click',async()=>{
  const msg=document.getElementById('inputMessage').value,password=document.getElementById('password').value;
  if(!msg||!password){alert("Enter both message and password!");return;}
  if(!checkPasswordStrength(password))return;
  const encrypted=await encryptMessage(msg,password);
  const output=document.getElementById('outputMessage');output.value=encrypted;
  setTimeout(()=>output.value="",30000); // auto-clear output after 30s
});

document.getElementById('decryptBtn').addEventListener('click',async()=>{
  const enc=document.getElementById('inputMessage').value,password=document.getElementById('password').value;
  if(!enc||!password){alert("Enter both encrypted message and password!");return;}
  if(!checkPasswordStrength(password))return;
  const decrypted=await decryptMessage(enc,password);
  const output=document.getElementById('outputMessage');output.value=decrypted;
  setTimeout(()=>output.value="",30000); // auto-clear output after 30s
});
</script>
</body>
</html>
